(()=>{"use strict";const t=["todo","inprogress","done"],e="trelloBoardState";function n(){const t=localStorage.getItem(e);return t?JSON.parse(t):{todo:[],inprogress:[],done:[]}}function a(t){localStorage.setItem(e,JSON.stringify(t))}function r(){const e=n();t.forEach((t=>{const o=document.querySelector(`[data-card-list="${t}"]`);o&&(o.innerHTML="",e[t].forEach(((e,s)=>{const c=document.createElement("div");c.className="card",c.dataset.id=s,c.dataset.column=t,c.draggable=!0;const d=document.createElement("div");d.textContent=e;const i=document.createElement("span");i.className="delete-btn",i.textContent="×",i.addEventListener("click",(()=>function(t,e){const o=n();o[t].splice(e,1),a(o),r()}(t,s))),c.append(d),c.append(i),o.append(c)})))}))}let o=null,s=null;function c(t){t.preventDefault(),t.dataTransfer.dropEffect="move";const e=t.target;(e.classList.contains("card-list")||e.classList.contains("column"))&&e.classList.add("drop-area")}function d(t){t.preventDefault()}function i(t){const e=t.target;e.classList.contains("drop-area")&&e.classList.remove("drop-area")}function l(t){t.preventDefault();const e=t.target,c=e.classList.contains("card-list")?e:e.closest(".card-list");if(!c||!o)return;const d=c.dataset.cardList,i=n(),l=Array.from(o.parentNode.querySelectorAll(".card")).findIndex((t=>t.dataset.id===o.dataset.id));if(-1===l)return console.warn("Карточка не найдена в исходной колонке"),void u();i[s].splice(l,1);const m=Array.from(c.querySelectorAll(".card"));let f=m.length;for(let e=0;e<m.length;e++){const n=m[e].getBoundingClientRect();if(t.clientY<n.top+n.height/2){f=e;break}}const g=o.querySelector("div").textContent;i[d].splice(f,0,g),a(i),o.remove(),r(),c.classList.remove("drop-area"),u()}function u(){o&&(o.classList.remove("dragging"),document.contains(o)&&o.remove()),o=null,s=null}document.addEventListener("DOMContentLoaded",(()=>{r(),document.querySelectorAll(".add-card-btn").forEach((t=>{t.addEventListener("click",(()=>{!function(t){const e=n(),o=prompt("Введите текст карточки:");o&&""!==o.trim()&&(e[t].push(o.trim()),a(e),r())}(t.dataset.column)}))})),document.addEventListener("dragstart",(t=>{t.target.classList.contains("card")&&function(t){o=t.target,s=o.dataset.column,o.classList.add("dragging"),t.dataTransfer.effectAllowed="move",t.dataTransfer.setData("text/plain",o.dataset.id)}(t)})),document.addEventListener("dragover",c),document.addEventListener("dragenter",d),document.addEventListener("dragleave",i),document.addEventListener("drop",l),document.addEventListener("dragend",u)}))})();